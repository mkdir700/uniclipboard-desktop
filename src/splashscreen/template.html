<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>UniClipboard</title>
    <style>
      /* ========== ANIMATIONS_CSS ========== */
      /* ANIMATIONS_CSS */

      /* ========== 基础布局 ========== */
      body {
        margin: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        background: var(--background);
        color: var(--foreground);
      }

      .splash-root {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 2rem;
      }

      .splash-brand {
        font-size: 2.5rem;
        font-weight: 300;
        letter-spacing: 0.1em;
        color: var(--foreground);
      }

      .splash-letter {
        display: inline-block;
        animation: fade-in-up 0.6s ease-out backwards;
      }

      .splash-status {
        font-size: 0.875rem;
        color: var(--muted-foreground);
        font-weight: 500;
      }

      .splash-dots {
        display: flex;
        gap: 0.5rem;
      }

      .splash-dot {
        width: 0.5rem;
        height: 0.5rem;
        border-radius: 50%;
        background: var(--primary);
        opacity: 0.7;
        animation: pulse-wave 1.5s ease-in-out infinite;
      }

      /* ========== THEMES_CSS ========== */
      /* THEMES_CSS */

      /* ========== 默认降级样式 ========== */
      :root {
        --background: oklch(1 0 0);
        --foreground: oklch(0.21 0.006 285.885);
        --muted-foreground: oklch(0.552 0.014 285.938);
        --primary: oklch(0.21 0.006 285.885);
      }
    </style>
  </head>
  <body>
    <div class="splash-root">
      <div class="splash-brand">
        <span class="splash-letter" style="animation-delay: 0s">U</span>
        <span class="splash-letter" style="animation-delay: 0.05s">n</span>
        <span class="splash-letter" style="animation-delay: 0.1s">i</span>
        <span class="splash-letter" style="animation-delay: 0.15s">C</span>
        <span class="splash-letter" style="animation-delay: 0.2s">l</span>
        <span class="splash-letter" style="animation-delay: 0.25s">i</span>
        <span class="splash-letter" style="animation-delay: 0.3s">p</span>
        <span class="splash-letter" style="animation-delay: 0.35s">b</span>
        <span class="splash-letter" style="animation-delay: 0.4s">o</span>
        <span class="splash-letter" style="animation-delay: 0.45s">a</span>
        <span class="splash-letter" style="animation-delay: 0.5s">r</span>
        <span class="splash-letter" style="animation-delay: 0.55s">d</span>
      </div>
      <div class="splash-status">Initializing...</div>
      <div class="splash-dots">
        <span class="splash-dot" style="animation-delay: -0.4s"></span>
        <span class="splash-dot" style="animation-delay: -0.2s"></span>
        <span class="splash-dot" style="animation-delay: 0s"></span>
      </div>
    </div>

    <script>
      ;(function () {
        const root = document.documentElement

        console.log('=== [LAYER 4] SPLASHSCREEN: Script started ===')
        console.log(
          '=== [LAYER 4] SPLASHSCREEN: Initial __SPLASH_THEME__ value:',
          window.__SPLASH_THEME__,
          '==='
        )

        // ========== 主题来源优先级 / Theme sources ==========
        // 1) Rust 初始化脚本注入 window.__SPLASH_THEME__（最可靠，避免竞态）
        // 2) localStorage（主应用 SettingContext 会写入；用于处理 reload/HMR 或注入缺失场景）
        // 3) 系统偏好（最后回退）
        const splashTheme = window.__SPLASH_THEME__ || {}
        console.log('=== [LAYER 5] SPLASHSCREEN: splashTheme object:', splashTheme, '===')

        let savedTheme = null
        let savedThemeColor = null
        try {
          savedTheme = localStorage.getItem('uc-theme')
          savedThemeColor = localStorage.getItem('uc-theme-color')
        } catch (e) {
          console.warn('Failed to read theme from localStorage:', e)
        }

        const theme = splashTheme.theme_color || savedThemeColor || 'zinc'
        let mode = splashTheme.mode

        console.log(
          '=== [LAYER 5] SPLASHSCREEN: Extracted - theme_color="' +
            theme +
            '", mode="' +
            mode +
            '" ==='
        )

        // 如果 Rust 没给出 mode（或无效），尝试从 localStorage 读取
        if (mode !== 'light' && mode !== 'dark') {
          if (savedTheme === 'light' || savedTheme === 'dark') {
            mode = savedTheme
            console.log('=== [LAYER 5] SPLASHSCREEN: Mode from localStorage: ' + mode + ' ===')
          }
        }

        // 如果 mode 仍未设置，回退到系统偏好
        if (mode !== 'light' && mode !== 'dark') {
          const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches
          console.log(
            '=== [LAYER 5] SPLASHSCREEN: Mode not set, using system preference. prefers-dark=' +
              systemPrefersDark +
              ' ==='
          )
          mode = systemPrefersDark ? 'dark' : 'light'
        }

        // ========== 应用主题 ==========
        console.log(
          '=== [LAYER 6] SPLASHSCREEN: Applying theme - data-theme="' +
            theme +
            '", mode="' +
            mode +
            '" ==='
        )
        root.setAttribute('data-theme', theme)
        root.classList.remove('dark', 'light')
        if (mode === 'dark') {
          root.classList.add('dark')
        } else if (mode === 'light') {
          root.classList.add('light')
        }

        console.log(
          '=== [LAYER 6] SPLASHSCREEN: Final state - data-theme=' +
            root.getAttribute('data-theme') +
            ', classList=' +
            root.className +
            ' ==='
        )

        // ========== 监听系统主题变化（仅当使用系统主题时） ==========
        const explicitMode = splashTheme.mode === 'light' || splashTheme.mode === 'dark'
        const explicitStoredMode = savedTheme === 'light' || savedTheme === 'dark'
        if (!explicitMode && !explicitStoredMode) {
          console.log('=== [LAYER 7] SPLASHSCREEN: Setting up system theme listener ===')
          window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
            console.log(
              '=== [LAYER 7] SPLASHSCREEN: System theme changed to ' +
                (e.matches ? 'dark' : 'light') +
                ' ==='
            )
            root.classList.toggle('dark', e.matches)
            root.classList.toggle('light', !e.matches)
          })
        }
      })()
    </script>
  </body>
</html>
