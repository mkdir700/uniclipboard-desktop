<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>UniClipboard</title>
    <style>
      /* ========== ANIMATIONS_CSS ========== */
      /* 由构建脚本注入 animations.css 内容 */

      /* ========== 基础布局 ========== */
      body {
        margin: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        background: var(--background);
        color: var(--foreground);
      }

      .splash-root {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 2rem;
      }

      .splash-brand {
        font-size: 2.5rem;
        font-weight: 300;
        letter-spacing: 0.1em;
        color: var(--foreground);
      }

      .splash-letter {
        display: inline-block;
        animation: fade-in-up 0.6s ease-out backwards;
      }

      .splash-status {
        font-size: 0.875rem;
        color: var(--muted-foreground);
        font-weight: 500;
      }

      .splash-dots {
        display: flex;
        gap: 0.5rem;
      }

      .splash-dot {
        width: 0.5rem;
        height: 0.5rem;
        border-radius: 50%;
        background: var(--primary);
        opacity: 0.7;
        animation: pulse-wave 1.5s ease-in-out infinite;
      }

      /* ========== THEMES_CSS ========== */
      /* 由构建脚本注入所有主题 CSS */

      /* ========== 默认降级样式 ========== */
      :root {
        --background: oklch(1 0 0);
        --foreground: oklch(0.21 0.006 285.885);
        --muted-foreground: oklch(0.552 0.014 285.938);
        --primary: oklch(0.21 0.006 285.885);
      }
    </style>
  </head>
  <body>
    <div class="splash-root">
      <div class="splash-brand">
        <span class="splash-letter" style="animation-delay: 0s">U</span>
        <span class="splash-letter" style="animation-delay: 0.05s">n</span>
        <span class="splash-letter" style="animation-delay: 0.1s">i</span>
        <span class="splash-letter" style="animation-delay: 0.15s">C</span>
        <span class="splash-letter" style="animation-delay: 0.2s">l</span>
        <span class="splash-letter" style="animation-delay: 0.25s">i</span>
        <span class="splash-letter" style="animation-delay: 0.3s">p</span>
        <span class="splash-letter" style="animation-delay: 0.35s">b</span>
        <span class="splash-letter" style="animation-delay: 0.4s">o</span>
        <span class="splash-letter" style="animation-delay: 0.45s">a</span>
        <span class="splash-letter" style="animation-delay: 0.5s">r</span>
        <span class="splash-letter" style="animation-delay: 0.55s">d</span>
      </div>
      <div class="splash-status">Initializing...</div>
      <div class="splash-dots">
        <span class="splash-dot" style="animation-delay: -0.4s"></span>
        <span class="splash-dot" style="animation-delay: -0.2s"></span>
        <span class="splash-dot" style="animation-delay: 0s"></span>
      </div>
    </div>

    <script>
      ;(async function () {
        const root = document.documentElement
        let theme = 'zinc' // 默认主题
        let mode = null // null = 未设置

        // ========== 1. 尝试 Tauri API ==========
        if (window.__TAURI__) {
          try {
            const { invoke } = await import('@tauri-apps/api/core')
            const settings = await invoke('get_settings')

            const userTheme = settings?.general?.theme
            const userThemeColor = settings?.general?.theme_color || 'zinc'

            theme = userThemeColor

            if (userTheme === 'light') {
              mode = 'light'
            } else if (userTheme === 'dark') {
              mode = 'dark'
            }
          } catch (e) {
            console.warn('无法读取 Tauri 配置:', e)
          }
        }

        // ========== 2. 回退到 localStorage ==========
        if (mode === null) {
          const savedTheme = localStorage.getItem('uc-theme')
          const savedThemeColor = localStorage.getItem('uc-theme-color')

          if (savedThemeColor) theme = savedThemeColor
          if (savedTheme === 'light' || savedTheme === 'dark') {
            mode = savedTheme
          }
        }

        // ========== 3. 系统默认 ==========
        if (mode === null) {
          mode = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'
        }

        // ========== 应用主题 ==========
        root.setAttribute('data-theme', theme)
        if (mode === 'dark') {
          root.classList.add('dark')
        }

        // ========== 监听系统主题变化 ==========
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
          if (!localStorage.getItem('uc-theme')) {
            root.classList.toggle('dark', e.matches)
          }
        })
      })()
    </script>
  </body>
</html>
